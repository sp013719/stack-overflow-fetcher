# Stack Overflow Fetcher API

## Overview

This Spring Boot application fetches questions and answers from Stack Overflow and provides a set of RESTful APIs to:

1. **Submit a Download Job** (`POST /api/download?creationDate={yyyy-MM-dd}`) - Creates an async job to fetch questions and merge answers.
2. **Get Download Job Status** (`GET /api/download/{taskId}`) - Retrieves the status of a download job.
3. **Download Processed Data** (`GET /api/download/{taskId}/file`) - Downloads the processed file containing questions and their answers.

## API Documentation

### 1. **Submit a Download Job**

**Endpoint:**

```http
POST /api/download?questionDate={yyyy-MM-dd}
```

**Description:**

- Submits a request to create an async job that fetches questions created on a specific date.
- The async job also merges answers into each question if available.
- Returns a **UUID** as the job ID.

**Request Parameters:**

- `questionDate` (Required, `yyyy-MM-dd`) - The creation date of the questions to fetch.

**Response:**

```json
{
  "taskId": "550e8400-e29b-41d4-a716-446655440000"
}
```

**Design Considerations:**

- This API is **asynchronous**, meaning users must check the job status before downloading the processed file.
- The job is processed in the **background** to avoid long waiting time as it will need to fetch all the questions of specific date and the corresponding answers.

---

### 2. **Get Download Job Status**

**Endpoint:**

```http
GET /api/download/{taskId}
```

**Description:**

- Retrieves the **current status** of a download job created by the first endpoint.
- Users can check this before attempting to download the processed file.

**Path Parameters:**

- `taskId` (Required) - The UUID returned by the **Submit a Download Job** API.

**Response Examples:**

- **Pending Job:**

```json
{
  "taskId": "550e8400-e29b-41d4-a716-446655440000",
  "status": "Pending"
}
```

- **Job in Progress:**

```json
{
  "taskId": "550e8400-e29b-41d4-a716-446655440000",
  "status": "In Progress"
}
```

- **Completed Job:**

```json
{
  "taskId": "550e8400-e29b-41d4-a716-446655440000",
  "status": "Completed"
}
```

**Design Considerations:**

- Jobs are stored in **Redis** for fast retrieval and tracking.
- This ensures **reliability** even if the application restarts.

---

### 3. **Download Processed Data**

**Endpoint:**

```http
GET /api/download/{taskId}/file
```

**Description:**

- Downloads the processed file containing questions and their answers for a specific creation date.
- The file is generated by the async job from the first endpoint.

**Path Parameters:**

- `taskId` (Required) - The UUID returned by the **Submit a Download Job** API.

**Response:**

- Returns the JSONL file containing **questions and their respective answers**.
- If the file is not ready, it returns `404 Not Found`.

**Design Considerations:**

- Ensures **high availability** by keeping processed files in an output directory.

---

## How to Use the API

1. **Submit a request to process questions for a specific date:**
   ```sh
   curl -X POST "http://localhost:8080/api/download?creationDate=2025-03-11"
   ```
2. **Check the job status using the returned **``**:**
   ```sh
   curl -X GET "http://localhost:8080/api/download/550e8400-e29b-41d4-a716-446655440000"
   ```
3. **Download the processed file when the status is "Completed":**
   ```sh
   curl -X GET -O "http://localhost:8080/api/download/550e8400-e29b-41d4-a716-446655440000/file"
   ```

---
## How to Deploy the Application on Kubernetes

1. Apply the Redis deployment and service:

    ```sh
    kubectl apply -f redis-deployment.yaml
    ```

2. Apply the application deployment and service:

    ```sh
    kubectl apply -f deployment.yaml
    ```

3. Check the status of the deployments:

    ```sh
    kubectl get deployments
    ```

4. Check the status of the services:

    ```sh
    kubectl get services
    ```
---
## How to Destroy the Application on Kubernetes

1. Delete the application deployment and service:

    ```sh
    kubectl delete -f app-deployment.yaml
    ```

2. Delete the Redis deployment and service:

    ```sh
    kubectl delete -f redis-deployment.yaml
    ```
---
